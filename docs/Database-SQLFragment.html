<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Database.SQLFragment</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Database-SQLFragment.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">sql-fragment-0.0.1.0: SQL query combinator</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Database.SQLFragment</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Example</a></li><li><a href="#g:2">Documentation</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>SQLFragment is a type safe SQL combinator based on the idea that, a SQL query</p><ul><li>is a monoid</li><li>joins can be deduced automatically from an join graph.</li></ul><p>SQLFragment main intent is to allow to build easily complex query by reusing and combining pre-made fragments (which can be typed or typeless).
This is especially useful when building reporting tools, when a lot of queries are similar and the results 
are either table or charts. In that case, query output can be used &quot;raw&quot; (.i.e a list of tuple or equivalent) and don't need to be mapped to any complex data type.
Unlike many other SQL package, which make it hard to combine <code><a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a></code> and <code><a href="file:///usr/share/doc/ghc-doc/html/libraries/base-4.7.0.2/Data-String.html#t:String">String</a></code>, SQLFragment makes it easy to write raw SQL if needed.
Its purpose is to help write query quickly not make developper life hard.
We trust the developper to not use &quot;unsafe&quot; string.</p><p>SQLFragment also provide support for dimensional units, <code>HList</code> records and automatic fragments generation from a database. The fragments generation use a space separated values file which can be generated from the database (see corresponding backend).</p><p>For more details look at the Database.SQLFragment.SQLFragment and Database.SQLFragment.Operators.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short">module <a href="Database-SQLFragment-SQLFragment.html">Database.SQLFragment.SQLFragment</a></li><li class="src short">module <a href="Database-SQLFragment-Operators.html">Database.SQLFragment.Operators</a></li><li class="src short">module <a href="Database-SQLFragment-Dimensional.html">Database.SQLFragment.Dimensional</a></li><li class="src short"><a href="#v:autoJoin">autoJoin</a> ::  <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>] -&gt; <a href="file:///usr/share/doc/ghc-doc/html/libraries/base-4.7.0.2/Data-Either.html#t:Either">Either</a> (<a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p) (<a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p)</li><li class="src short"><a href="#v:-33--45--62--33-">(!-&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--42--45--62--33-">(!*-&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--45--42--62--33-">(!-*&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--60--45--62--33-">(!&lt;-&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--60--45--42--62--33-">(!&lt;-*&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--60--45--42--45--62--33-">(!&lt;-*-&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li><li class="src short"><a href="#v:-33--60--42--62--33-">(!&lt;*&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</li></ul></div><div id="interface"><h1 id="g:1">Example</h1><div class="doc"><p>Let's say we have a table of customers, products, and orders, joining a customer to n products.
I want to display in table the list of the customer which ordered the product 'blue T-shirt'.</p><p>With SQLFragment, supposing I have defined <code>email</code> and <code>blue</code> fragments so that</p><pre>&gt; toSelectQuery email
&quot;SELECT email FROM customers&quot;

&gt; toSelectQuery blue
&quot;FROM product WHERE description = 'blue T-shirt'&quot;
</pre><p>and the join graph as been properly set up in <code>joins</code>.</p><p>I can simply combine those two fragment using <code>&lt;&gt;</code>.</p><pre>&gt; toSelectQuery $ email &lt;&gt; blue !@! joins
&quot;SELECT email 
FROM customers
JOIN orders ON (customers.id = customer_id)
JOIN products ON (products.id = product_id)
WHERE products.description = 'blue T-shirt'
&quot;
</pre></div><h1 id="g:2">Documentation</h1><div class="top"><p class="src">module <a href="Database-SQLFragment-SQLFragment.html">Database.SQLFragment.SQLFragment</a></p></div><div class="top"><p class="src">module <a href="Database-SQLFragment-Operators.html">Database.SQLFragment.Operators</a></p></div><div class="top"><p class="src">module <a href="Database-SQLFragment-Dimensional.html">Database.SQLFragment.Dimensional</a></p></div><div class="top"><p class="src"><a name="v:autoJoin" class="def">autoJoin</a> ::  <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>] -&gt; <a href="file:///usr/share/doc/ghc-doc/html/libraries/base-4.7.0.2/Data-Either.html#t:Either">Either</a> (<a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p) (<a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> e p)</p><div class="doc"><p>Computes the mimimum set of join needed to cover the tables from an <code><a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a></code> .</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>:set -XDataKinds -XOverloadedStrings
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let a = &quot;a.x&quot; :: SQLFragment '[] '[]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let b = &quot;b.x&quot;  :: SQLFragment '[] '[]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let c = &quot;c.x&quot; :: SQLFragment '[] '[]
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>let g = a !-&gt;! b ++ b !-&gt;! c
</code></strong><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>either toSelectQuery toSelectQuery $ autoJoin (a !&amp;! b) g
</code></strong>&quot;SELECT a.x, b.x\nFROM a JOIN b ON ((a.x)=(b.x))&quot;
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>either toSelectQuery toSelectQuery $ autoJoin (b !&amp;! c) g
</code></strong>&quot;SELECT b.x, c.x\nFROM b JOIN c ON ((b.x)=(c.x))&quot;
<code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>either toSelectQuery toSelectQuery $ autoJoin (a !&amp;!c) g
</code></strong>&quot;SELECT a.x, c.x\nFROM a JOIN b ON ((a.x)=(b.x)) JOIN c ON ((b.x)=(c.x))&quot;
</pre></div></div><div class="top"><p class="src"><a name="v:-33--45--62--33-" class="def">(!-&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Unidirectional inner join</p></div></div><div class="top"><p class="src"><a name="v:-33--42--45--62--33-" class="def">(!*-&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Unidirectional right join</p></div></div><div class="top"><p class="src"><a name="v:-33--45--42--62--33-" class="def">(!-*&gt;!)</a> :: <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Unidirectional left join</p></div></div><div class="top"><p class="src"><a name="v:-33--60--45--62--33-" class="def">(!&lt;-&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Bidirectional inner join</p></div></div><div class="top"><p class="src"><a name="v:-33--60--45--42--62--33-" class="def">(!&lt;-*&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Bidirectional left,right join</p></div></div><div class="top"><p class="src"><a name="v:-33--60--45--42--45--62--33-" class="def">(!&lt;-*-&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Bidirectional left,left join</p></div></div><div class="top"><p class="src"><a name="v:-33--60--42--62--33-" class="def">(!&lt;*&gt;!)</a> :: (<a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> b a), <a href="Database-SQLFragment-TypeFamilies.html#t:Boolables">Boolables</a> (<a href="Database-SQLFragment-Operators.html#t:ZipToBool">ZipToBool</a> a b)) =&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> b ([] *) -&gt; <a href="Database-SQLFragment-SQLFragment.html#t:SQLFragment">SQLFragment</a> a ([] *) -&gt; [<a href="Database-SQLFragment-SQLFragment.html#t:Join">Join</a>]</p><div class="doc"><p>Bidirectional outer join</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>